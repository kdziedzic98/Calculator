<!DOCTYPE html>
<html>
  <head>
    <title>Chess</title>
    <link rel="stylesheet" href="css/chessboard-1.0.0.min.css">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="js/chessboard-1.0.0.min.js"></script>
    <script src="chess.js-master/chess.js"></script>
  </head>
  <body>
    <div id="board1" style="width: 400px"></div>
    <button id="startBtn">Start Position</button>
    <button id="clearBtn">Clear Board</button>
    <button id="testBtn">test</button>
    <script>

        var board1 = null
        var game = new Chess()

        //funkcja ustalająca możliwość wykonania ruchu jedynie białymi figurami oraz zablokowanie wykonania ruchu po zakończeniu gry
        function onDragStart (source, piece, position, orientation) {

            if (game.game_over()) return false

            if (piece.search(/^b/) !== -1)  return false
          
        }

        function makeRandomMove () {
            var possibleMoves = game.moves()

            // game over
            if (possibleMoves.length === 0) return

            var randomIdx = Math.floor(Math.random() * possibleMoves.length)
            game.move(possibleMoves[randomIdx])
            board1.position(game.fen())
        }

        //funkcja wyświetlająca pozycję startową, pozycję docelową, rodzaj figury, ustawienie szachownicy przed ruchem oraz ustawienie szachownicy po ruchu
        function onDrop (source, target, piece, oldPos, newPos ) {
          console.log('Position changed:')
          console.log('Source: ' + source)
          console.log('Target: ' + target)
          console.log('Piece: ' + piece)
          console.log('Old position: ' + Chessboard.objToFen(oldPos))
          console.log('New position: ' + Chessboard.objToFen(newPos))
          console.log('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~')

            // see if the move is legal
          var move = game.move({
            from: source,
            to: target,
            promotion: 'q' // NOTE: always promote to a queen for example simplicity
          })

          // illegal move
          if (move === null) return 'snapback'

          // make random legal move for black
          window.setTimeout(makeRandomMove, 250)

        }


        function onSnapEnd () {
          board1.position(game.fen())
        }

        //ustalanie konfiguracji szachownicy
        var config = {
            position: '3qk3/8/pppppppp/8/8/PPPPPPPP/8/3QK3',
            draggable: true,
            moveSpeed: 'slow',
            snapbackSpeed: 500,
            snapSpeed: 100,
            onDragStart: onDragStart,
            onDrop: onDrop,
            onSnapEnd: onSnapEnd
        };

        //tworzenie szachownicy na podstawie config
        board1 = Chessboard('board1', config);

        $('#startBtn').on('click', function() { board1.position('3qk3/8/pppppppp/8/8/PPPPPPPP/8/3QK3')  });
        $('#clearBtn').on('click', board1.clear);
        $('#testBtn').on('click', function () { board1.move('e3-e5')    });
    </script>
  </body>
</html>